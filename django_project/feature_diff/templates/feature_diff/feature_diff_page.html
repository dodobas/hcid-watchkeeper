{% extends "feature_diff/feature_diff_base.html" %}
{% load pipeline %}

{% block content %}

<div class="container-fluid">
    <div class="row">
      {# side panel #}
      <div class="col-lg-8" id="side_panel">
        <div class="bs-component">
          <div class="panel panel-primary">
            <div class="panel-heading panel-heading-title">
              CHANGESETS COMPARE
            </div>
            <div class="panel-body user-profile">
              <table class="display dataTable no-footer" width="100%">
                <tr id="heading_row">
                  <th class="col-md-4 right-align dark-color">
                    <div class="btn-group">
                      <select class="form-control dark-color" id="changeset_id1" onchange="changesetRedirect('changeset_id1')">
                        {% for item in available_changeset_ids %}
                          <option value="{{ item }}"
                          {% if changeset_id1 == item %}
                            selected
                          {% endif %}
                          >Changeset {{ item }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </th>
                  <th class="col-md-4"></th>
                  <th class="col-md-4 left-align dark-color">
                    <div class="btn-group">
                      <select class="form-control dark-color" id="changeset_id2" onchange="changesetRedirect('changeset_id2')">
                        {% for item in available_changeset_ids %}
                          <option value="{{ item }}"
                            {% if changeset_id2 == item %}
                              selected
                            {% endif %}
                          >Changeset {{ item }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </th>
                </tr>
                <tr id="metadata_row1">
                  <th class="right-align normal-weight">{{ metadata.changeset1.email }}</th>
                  <th><b>Created by</b></th>
                  <th class="left-align normal-weight">{{ metadata.changeset2.email }}</th>
                </tr>
                <tr id="metadata_row2">
                  <th class="right-align normal-weight">{{ metadata.changeset1.ts }}</th>
                  <th><b>Created at</b></th>
                  <th class="left-align normal-weight">{{ metadata.changeset2.ts }}</th>
                </tr>
                {% for label, values in table.items %}
                    <tr
                      {% if label in different_labels %}
                        class="different">
                      {% else %}
                        class="regular">
                      {% endif %}
                      <td class="right-align">{{ values.changeset1_value }}</td>
                      <td><b>{{ label }}</b></td>
                      <td class="left-align">{{ values.changeset2_value }}</td>
                    </tr>
                {% empty %}

                {% endfor %}
              </table>
            </div>
          </div>

        </div>
      </div>
      {# end side panel #}
    </div>
  </div>

{% endblock %}


{% block extra_style %}
  <style>

    /* https://www.w3schools.com/css/css_rwd_mediaqueries.asp */
    @media only screen and (max-width: 950px) {
      .col-lg-5 {
        width: 100%;
      }
    }

    tr#heading_row, tr#metadata_row1, tr#metadata_row2 {
      background-color: transparent;
      border-bottom: 1px solid rgb(51, 51, 51);
    }

    th {
      color: rgba(0, 0, 0, 0.65);
      text-align: center;
    }

    table.dataTable.display tbody th {
      border: none;
    }

    table.dataTable.display tbody tr:hover {
      cursor: default;
    }

    table.dataTable.display tbody tr.regular:nth-child(even) {
      background-color: rgb(249, 249, 249);
    }

    table.dataTable.display tbody tr.regular:nth-child(odd) {
      background-color: rgb(255, 255, 255);
    }

    table.dataTable.display tbody tr.regular {
      border-bottom: 1px solid rgb(221, 221, 221);
      text-align: center;
    }

    table.dataTable.display tbody tr.regular:hover {
      background-color: rgb(67, 67, 67);
      color: rgb(254, 254, 254);
    }

    table.dataTable.display tbody tr.different:hover {
      background-color: rgb(150, 67, 67);
      color: rgb(254, 254, 254);
    }

    table.dataTable.display tbody tr.different {
      background-color: rgb(67, 67, 67);
      color: rgb(254, 254, 254);
    }

    .left-align {
      text-align: left;
    }

    .right-align {
      text-align: right;
    }

    .normal-weight {
      font-weight: normal;
    }

  .dark-color {
    color: rgb(51, 51, 51);
  }

  /* https://stackoverflow.com/questions/23892204/have-a-scroll-bar-in-drop-down-list-html */
  #ch1-drpdn {
    max-height: 10px;
    overflow: scroll;
  }

  </style>
{% endblock %}


{% block extra_js %}
  <script>
  function changesetRedirect(select_id) {
    var changeset_id1;
    var changeset_id2;
    var feature_uuid = "{{ feature_uuid }}"

    if (select_id.slice(-1) == "1") {
      changeset_id1 = document.getElementById(select_id).value;
      changeset_id2 = {{ changeset_id2 }};
    }

    else {
      changeset_id1 = {{ changeset_id1 }};
      changeset_id2 = document.getElementById(select_id).value;
    }

    /* https://www.w3schools.com/js/js_window_location.asp */
    window.location.assign("/difference_viewer/" + feature_uuid + "/" + changeset_id1 + "/" + changeset_id2);

  }
  </script>
{% endblock %}
