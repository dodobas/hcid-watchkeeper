{% extends "base.html" %}
{% load pipeline %}


{% block content %}
    <div class="container-fluid">
        <div class="row">
            {# side panel #}
            <div class="col-lg-5" id="side_panel">
                <div class="bs-component">
                  <div class="panel panel-primary">
                          <div class="panel-heading panel-heading-title">
                            UPLOAD HISTORY
                          </div>
                            <div class="panel-body user-profile">
                              {% for item in history_list %}
                                <!-- https://stackoverflow.com/questions/40592278/cant-prevent-default-link-action -->
                                <a href="file_history/{{ item.0 }}" onclick="myFunc({{ item.0 }},'{{ item.2 }}'); return false;">{{ item.2 }} (uploaded on {{ item.1 }})</a><br>
                              {% endfor %}
                            </div>
                  </div>

                </div>
            </div>
            {# end side panel #}
        </div>
    </div>


<!-- https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_modal -->
<style>
  .modal{
      overflow: auto;
      background-color: #1f1e1d;
      background-color: rgba(31, 30, 29, 0.75);
  }

  </style>

  <div class="modal wb-modal-form in" id="wb-history-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document" style="width:70%">
    <div class="modal-content">
      <div class="modal-body">
    <div id="wb-dialog">
      <div class="wb-dialog-form">
        <div class="panel panel-primary">

          <div class="panel-heading panel-heading-without-padding">
            <h4 ><span id="modal-title"></span>
              <button type="button" id="x-sign" class="close" data-dismiss="modal" aria-label="Close><span aria-hidden="true">Ã—</span></button>
            </h4>
          </div>

          <div class="panel-body" style="padding:12px">
            <p id="content-html"></p>
          </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="close-btn">Close</button>
      </div>
    </div>
  </div>
</div>
  </div>
  </div>
  </div>
  </div>

<script>
var modal = document.getElementById('wb-history-modal');
var close = document.getElementById('x-sign');
var close_btn = document.getElementById('close-btn');

// https://stackoverflow.com/questions/3038901/how-to-get-the-response-of-xmlhttprequest
 function myFunc(file_id,file_name) {
   var html_text = '';
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (xhr.readyState == XMLHttpRequest.DONE) {
          html_text = xhr.responseText;
          document.getElementById('content-html').innerHTML = html_text;
          document.getElementById('modal-title').innerHTML = file_name;
          modal.style.display = "block";
      }
      };
    xhr.open('GET', '/file_history/'+file_id, true);
    xhr.send(null);
}

close.onclick = function () {
  modal.style.display = "none";
};

close_btn.onclick = function () {
  modal.style.display = "none";
};

window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
};

// https://stackoverflow.com/questions/3369593/how-to-detect-escape-key-press-with-pure-js-or-jquery
$(document).keyup(function(e) {
     if (e.keyCode == 27) { // escape key maps to keycode `27`
        modal.style.display = "none";
    }
});

</script>
{% endblock %}
