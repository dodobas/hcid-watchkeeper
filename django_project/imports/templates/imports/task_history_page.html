<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
</head>
<body>


{% for item in task_state_list %}
  {% if item.new_state == 'u' %}
    File uploaded and analysed at {{ item.changed_at }}
    <br><br>

    {% if item.error_msgs|length > 0 %}
      During analysis of uploaded file following <b>errors</b> were found:<br>
      {{ item.error_msgs|safe }}
    {% endif %}

    {% if item.warning_msgs|length > 0 %}
      <br>
      During analysis of uploaded file following <b>warnings</b> were found:<br>
      {{ item.warning_msgs|safe }}
    {% endif %}

    {% if item.error_msgs|length == 0 and item.warning_msgs|length == 0 %}
      No errors were found during analysis of uploaded file.
    {% endif %}

    {% if task_state_list|length == 1 %}
      {% if item.report_dict.num_add > 0 or item.report_dict.num_update > 0 %}
        <br>Data from uploaded file have not been added in database.<br>

        {% if item.report_dict.num_add > 0 %}
          Rows that can be added: {{ item.report_dict.num_add }}<br>
        {% endif %}

        {% if item.report_dict.num_update > 0 %}
          Rows that can be added: {{ item.report_dict.num_update }}<br>
        {% endif %}


        {% if  item.report_dict.num_add > 0 or item.report_dict.num_update > 0 %}
          <a href="/import_data/{{ item.task_id }}" class="btn btn-primary">Import</a>
        {% endif %}

      {% elif item.report_dict.num_add == 0 or item.report_dict.num_update == 0 %}
        <br>There aren't rows for insert or update in this file.

      {% endif %}
    {% endif %}

  {% elif item.new_state == 'i' %}
    <br>Data from uploaded file were inserted in database at {{ item.changed_at }}<br>
    {% if item.report_dict.num_add == 1 %}
      1 row was added.<br>
    {% elif item.report_dict.num_add > 1 %}
      {{ item.report_dict.num_add }} rows were added.<br>
    {% endif %}

    {% if item.report_dict.num_update == 1 %}
      1 row was updated.<br>
    {% elif item.report_dict.num_update > 1 %}
      {{ item.report_dict.num_update }} rows were updated.<br>
    {% endif %}
  {% endif %}
{% endfor %}
</body>
</html>
